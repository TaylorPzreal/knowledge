Review
1. 2023/02/11

> 函数是一等公民
> JavaScript 中的函数非常灵活，其根本原因在于 JavaScript 中的函数就是一种特殊的对象，我们把 JavaScript 中的函数称为**一等公民 (First Class Function)**。
> 
> 因为函数是一种特殊的对象，所以在 JavaScript 中，函数可以赋值给一个变量，也可以作为函数的参数，还可以作为函数的返回值。**如果某个编程语言的函数，可以和这个语言的数据类型做一样的事情，我们就把这个语言中的函数称为一等公民**。


什么是 JavaScript 中的对象？既然在 JavaScript 中，函数就是一种特殊的对象，那我们首先要明白，什么是 JavaScript 中的“对象”？它和面向对象语言中的“对象”有什么区别？和其他主流语言不一样的是，JavaScript 是一门基于对象 (Object-Based) 的语言，可以说 JavaScript 中大部分的内容都是由对象构成的，诸如函数、数组，也可以说 JavaScript 是建立在对象之上的语言。

![](./assets/50a6780df8eb_6bd43afb.webp)

而这些对象在运行时可以动态修改其内容，这造就了 JavaScript 的超级灵活特性。不过，因为 JavaScript 太灵活了，也加大了理解和使用这门语言的难度。虽然 JavaScript 是基于对象设计的，但是它却不是一门面向对象的语言 (Object—Oriented Programming Language)，因为面向对象语言天生支持封装、继承、多态，但是 JavaScript 并没有直接提供多态的支持，因此要在 JavaScript 中使用多态并不是一件容易的事。

JavaScript 中实现继承的方式却非常简单清爽，只是在对象中添加了一个称为原型的属性，把继承的对象通过原型链接起来，就实现了继承，我们把这种继承方式称为基于原型链继承。

JavaScript 中的对象非常简单，其核心本质都就是由一组组属性和值组成的集合

![](./assets/32c8ef949b2d_212a6f39.webp)

可以看出来，对象的属性值有三种类型：
1. 原始类型 (primitive)
2. 对象类型 (Object)
3. 函数类型 (Function)

在 JavaScript 中，函数是一种特殊的对象，它和对象一样可以拥有属性和值，但是函数和普通对象不同的是，函数可以被调用。被调用时，它还需要关联相关的执行上下文。

**V8 内部是怎么实现函数可调用特性的呢？**
其实在 V8 内部，会为函数对象添加了两个隐藏属性，具体属性如下图所示：
![[e3f719484f66_109cdffa.webp]]

也就是说，函数除了可以拥有常用类型的属性值之外，还拥有两个隐藏属性，分别是 **name** 属性和 **code** 属性。

由于函数的“可被调用”的特性，使得实现函数的可赋值、可传参和可作为返回值等特性变得有一点麻烦。因为在执行 JavaScript 函数的过程中，为了实现变量的查找，V8 会为其维护一个作用域链，如果函数中使用了某个变量，但是在函数内部又没有定义该变量，那么函数就会沿着作用域链去外部的作用域中查找该变量，具体流程如下图所示：
![](./assets/303f56d604b0_df8f69c5.webp)
```js
function foo(){
    var number = 1
    function bar(){
        number++
        console.log(number)
    }
    return bar
}
var mybar = foo()
mybar()
```

这个就是闭包。

